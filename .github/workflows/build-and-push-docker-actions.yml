name: Build and Deploy to DockerHub
on:
  push:
    tags:
      - v**

env:
  DOCKERHUB_USER: ${{ secrets.DOCKERHUB_USER }}
  DOCKERHUB_PASSWORD: ${{ secrets.DOCKERHUB_PASSWORD }}

jobs:
  setup-build-publish-deploy:
    name: Setup, Build, Publish, and Deploy
    runs-on: ubuntu-latest
    steps:

    - uses: olegtarasov/get-tag@v2
      id: tagName
          
    - name: echo verison
      run: echo will build ${{ steps.tagName.outputs.tag }}
        
    - name: Checkout
      uses: actions/checkout@v2

    - name: Build and push Client Docker image
      uses: docker/build-push-action@v1
      with:
        username: ${{ secrets.DOCKERHUB_USER }}
        password: ${{ secrets.DOCKERHUB_PASSWORD }}
        repository: tomat3/spiritspender
        tags: client-${{ steps.tagName.outputs.tag }}
        dockerfile: ./SpiritSpenderClient/pi.client.Dockerfile
        path: ./SpiritSpenderClient

    - name: Build and push Server Docker image
      uses: docker/build-push-action@v1
      with:
        username: ${{ secrets.DOCKERHUB_USER }}
        password: ${{ secrets.DOCKERHUB_PASSWORD }}
        repository: tomat3/spiritspender
        tags: server-${{ steps.tagName.outputs.tag }}
        dockerfile: ./SpiritSpenderServer/src/SpiritSpenderServer/pi.dockerfile
        path: ./SpiritSpenderServer/src/SpiritSpenderServer
